<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äºŒæ‰‹è½¦ä»·å€¼ä¼°ç®—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8ecf1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            font-size: 15px;
            color: #555;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 17px;
            transition: all 0.3s;
            background: #fafbfc;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #4a90e2;
            background: white;
        }
        
        .unit {
            position: relative;
        }
        
        .unit::after {
            content: attr(data-unit);
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 14px;
            pointer-events: none;
        }
        
        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }
        
        .result-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .result-value {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            text-align: left;
        }
        
        .detail-item {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .detail-label {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .coef-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }
        
        .coef-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }
        
        .coef-item:focus-within {
            border-color: #4a90e2;
            background: white;
        }
        
        .coef-item label {
            font-size: 13px;
            margin-bottom: 6px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .coef-item input {
            padding: 10px;
            font-size: 16px;
            text-align: center;
        }
        
        /* æ·»åŠ è¾“å…¥æ— æ•ˆçŠ¶æ€çš„æ ·å¼ */
        .coef-item input:invalid {
            border-color: #e74c3c;
            background-color: #fdf2f2;
        }
        
        .coef-item input:invalid:focus {
            border-color: #e74c3c;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            border: none;
            padding: 16px 32px;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
            width: 100%;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-reset {
            background: #e74c3c;
            color: white;
        }
        
        .btn-report {
            background: #27ae60;
            color: white;
        }
        
        .hint {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .coef-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            h1 {
                font-size: 24px;
            }
            .result-value {
                font-size: 36px;
            }
            .btn-group {
                grid-template-columns: 1fr;
            }
        }
        
        input::placeholder {
            color: #bbb;
        }
        
        .formula-hint {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            font-weight: normal;
        }
        
        /* æ·»åŠ èŒƒå›´æç¤ºæ ·å¼ */
        .range-hint {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— äºŒæ‰‹è½¦ä»·å€¼ä¼°ç®—</h1>
        
        <div class="grid">
            <!-- åŸºç¡€æˆæœ¬ -->
            <div class="card">
                <div class="card-title">ğŸ“‹ é‡ç½®æˆæœ¬</div>
                <div class="form-group unit" data-unit="ä¸‡å…ƒ">
                    <label>æ–°è½¦è´­ç½®ä»·</label>
                    <input type="number" id="carPrice" step="0.01" placeholder="0" value="0">
                </div>
                <div class="form-group unit" data-unit="ä¸‡å…ƒ">
                    <label>è´­ç½®ç¨</label>
                    <input type="number" id="purchaseTax" step="0.01" placeholder="0">
                </div>
                <div class="form-group unit" data-unit="ä¸‡å…ƒ">
                    <label>å…¶ä»–æ”¯å‡ºæˆæœ¬</label>
                    <input type="number" id="otherCost" step="0.01" placeholder="0">
                </div>
            </div>

            <!-- ä½¿ç”¨å¹´é™ -->
            <div class="card">
                <div class="card-title">â±ï¸ ä½¿ç”¨å¹´é™</div>
                <div class="form-group unit" data-unit="å¹´">
                    <label>å·²ä½¿ç”¨å¹´é™</label>
                    <input type="number" id="usedYears" step="0.1" placeholder="0" value="0">
                </div>
                <div class="form-group unit" data-unit="å¹´">
                    <label>è§„å®šä½¿ç”¨å¹´é™</label>
                    <input type="number" id="totalYears" step="1" placeholder="15" value="15">
                </div>
                <div class="form-group unit" data-unit="km">
                    <label>å·²è¡Œé©¶é‡Œç¨‹</label>
                    <input type="number" id="usedMileage" step="1" placeholder="0" value="0">
                </div>
                <div class="form-group unit" data-unit="km">
                    <label>è§„å®šè¡Œé©¶é‡Œç¨‹</label>
                    <input type="number" id="totalMileage" step="1" placeholder="600000" value="600000">
                </div>
            </div>

            <!-- è°ƒæ•´ç³»æ•° -->
            <div class="card" style="grid-column: 1 / -1;">
                <div class="card-title">ğŸ”§ ç»¼åˆè°ƒæ•´ç³»æ•° (0-1.0)</div>
                <div class="coef-grid">
                    <div class="coef-item">
                        <label>è½¦å†µæŠ€æœ¯çŠ¶å†µ</label>
                        <input type="number" id="techStatus" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>ç»´æŠ¤ä¿å…»</label>
                        <input type="number" id="maintenance" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>å“ç‰Œè½¦å‹å£ç¢‘</label>
                        <input type="number" id="reputation" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>è½¦è¾†ç”¨é€”</label>
                        <input type="number" id="usage" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>å·¥ä½œç¯å¢ƒ</label>
                        <input type="number" id="environment" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>é…ç½®ä¸é¢œè‰²</label>
                        <input type="number" id="config" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>ç”µæ± å¥åº·ç¨‹åº¦</label>
                        <input type="number" id="battery" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                    <div class="coef-item">
                        <label>ä¸‰ç”µç³»ç»ŸçŠ¶æ€</label>
                        <input type="number" id="powerSystem" step="0.01" min="0" max="1" placeholder="0-1" value="0">
                        <div class="range-hint">èŒƒå›´: 0-1.0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è®¡ç®—ç»“æœ -->
        <div class="result-card">
            <div class="result-label">è¯„ä¼°ä»·å€¼</div>
            <div class="result-value" id="finalResult">0.00 ä¸‡å…ƒ</div>
            
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">æ›´æ–°é‡ç½®æˆæœ¬</div>
                    <div class="detail-value" id="resetCost">0.00 ä¸‡</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">å¹´é™æˆæ–°ç‡</div>
                    <div class="detail-value" id="yearRate">0%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">é‡Œç¨‹æˆæ–°ç‡</div>
                    <div class="detail-value" id="mileageRate">0%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ç»¼åˆè°ƒæ•´ç³»æ•°</div>
                    <div class="detail-value" id="adjustCoef">0.00</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ç»¼åˆæˆæ–°ç‡</div>
                    <div class="detail-value" id="finalRate">0%</div>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-report" onclick="generateWordReport()">ğŸ“„ ç”ŸæˆWordæŠ¥å‘Š</button>
            <button class="btn btn-reset" onclick="resetForm()">ğŸ”„ é‡ç½®æ‰€æœ‰æ•°æ®</button>
        </div>
        
        <div class="hint">æ‰€æœ‰æ•°æ®ä»…æœ¬åœ°è®¡ç®—ï¼Œä¸ä¼šä¸Šä¼ æœåŠ¡å™¨</div>
    </div>

    <script>
        // è·å–æ‰€æœ‰è¾“å…¥å…ƒç´ 
        const inputs = document.querySelectorAll('input');
        
        // ä¸ºæ‰€æœ‰è¾“å…¥æ·»åŠ äº‹ä»¶ç›‘å¬
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                validateInput(this);
                calculate();
            });
        });
        
        // éªŒè¯è¾“å…¥å€¼
        function validateInput(input) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºè°ƒæ•´ç³»æ•°è¾“å…¥æ¡†
            const coefIds = ['techStatus', 'maintenance', 'reputation', 'usage', 
                           'environment', 'config', 'battery', 'powerSystem'];
            
            if (coefIds.includes(input.id)) {
                let value = parseFloat(input.value);
                // å¦‚æœå€¼å¤§äº1ï¼Œè‡ªåŠ¨è®¾ä¸º1
                if (value > 1) {
                    input.value = 1;
                    // å¯é€‰ï¼šæ·»åŠ è§†è§‰åé¦ˆï¼ˆé—ªçƒæ•ˆæœï¼‰
                    input.style.backgroundColor = '#fff3cd';
                    setTimeout(() => {
                        input.style.backgroundColor = '';
                    }, 300);
                }
                // å¦‚æœå€¼å°äº0ï¼Œè‡ªåŠ¨è®¾ä¸º0
                if (value < 0) {
                    input.value = 0;
                }
            }
        }
        
        function calculate() {
            // è·å–åŸºç¡€æˆæœ¬
            const carPrice = parseFloat(document.getElementById('carPrice').value) || 0;
            const purchaseTax = parseFloat(document.getElementById('purchaseTax').value) || 0;
            const otherCost = parseFloat(document.getElementById('otherCost').value) || 0;
            
            // è·å–å¹´é™å’Œé‡Œç¨‹
            const usedYears = parseFloat(document.getElementById('usedYears').value) || 0;
            const totalYears = parseFloat(document.getElementById('totalYears').value) || 1;
            const usedMileage = parseFloat(document.getElementById('usedMileage').value) || 0;
            const totalMileage = parseFloat(document.getElementById('totalMileage').value) || 1;
            
            // è·å–è°ƒæ•´ç³»æ•°ï¼ˆç¡®ä¿ä¸è¶…è¿‡1ï¼‰
            const techStatus = Math.min(parseFloat(document.getElementById('techStatus').value) || 0, 1);
            const maintenance = Math.min(parseFloat(document.getElementById('maintenance').value) || 0, 1);
            const reputation = Math.min(parseFloat(document.getElementById('reputation').value) || 0, 1);
            const usage = Math.min(parseFloat(document.getElementById('usage').value) || 0, 1);
            const environment = Math.min(parseFloat(document.getElementById('environment').value) || 0, 1);
            const config = Math.min(parseFloat(document.getElementById('config').value) || 0, 1);
            const battery = Math.min(parseFloat(document.getElementById('battery').value) || 0, 1);
            const powerSystem = Math.min(parseFloat(document.getElementById('powerSystem').value) || 0, 1);
            
            // è®¡ç®—æ›´æ–°é‡ç½®æˆæœ¬
            const resetCost = carPrice + purchaseTax + otherCost;
            
            // è®¡ç®—å¹´é™æˆæ–°ç‡ (é™åˆ¶åœ¨0-100%)
            let yearRate = (1 - usedYears / totalYears) * 100;
            yearRate = Math.max(0, Math.min(100, yearRate));
            
            // è®¡ç®—é‡Œç¨‹æˆæ–°ç‡ (é™åˆ¶åœ¨0-100%)
            let mileageRate = (1 - usedMileage / totalMileage) * 100;
            mileageRate = Math.max(0, Math.min(100, mileageRate));
            
            // è®¡ç®—æˆæ–°ç‡
            const conditionRate = (yearRate * mileageRate) / 100;
            
            // è®¡ç®—ç»¼åˆè°ƒæ•´ç³»æ•°
            const adjustCoef = techStatus * maintenance * reputation * usage * environment * config * battery * powerSystem;
            
            // è®¡ç®—ç»¼åˆæˆæ–°ç‡
            const finalRate = conditionRate * adjustCoef;
            
            // è®¡ç®—æœ€ç»ˆè¯„ä¼°å€¼
            const finalValue = resetCost * (finalRate / 100);
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('resetCost').textContent = resetCost.toFixed(2) + ' ä¸‡';
            document.getElementById('yearRate').textContent = yearRate.toFixed(1) + '%';
            document.getElementById('mileageRate').textContent = mileageRate.toFixed(1) + '%';
            document.getElementById('adjustCoef').textContent = adjustCoef.toFixed(3);
            document.getElementById('finalRate').textContent = finalRate.toFixed(1) + '%';
            document.getElementById('finalResult').textContent = finalValue.toFixed(2) + ' ä¸‡å…ƒ';
            
            // è¿”å›è®¡ç®—ç»“æœä¾›æŠ¥å‘Šä½¿ç”¨
            return {
                resetCost, yearRate, mileageRate, conditionRate, 
                adjustCoef, finalRate, finalValue,
                carPrice, purchaseTax, otherCost,
                usedYears, totalYears, usedMileage, totalMileage,
                techStatus, maintenance, reputation, usage, 
                environment, config, battery, powerSystem
            };
        }
        
        function generateWordReport() {
            const data = calculate();
            const date = new Date();
            const dateStr = date.getFullYear() + 'å¹´' + (date.getMonth() + 1) + 'æœˆ' + date.getDate() + 'æ—¥';
            const reportNo = 'PG-' + date.getFullYear() + String(date.getMonth() + 1).padStart(2, '0') + String(date.getDate()).padStart(2, '0') + '-' + Math.floor(Math.random() * 1000);
            
            // æ„å»ºWordæ–‡æ¡£å†…å®¹ï¼ˆHTMLæ ¼å¼ï¼‰
            const content = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40 '>
                <head>
                    <meta charset="utf-8">
                    <title>äºŒæ‰‹è½¦è¯„ä¼°æŠ¥å‘Š</title>
                    <style>
                        body { font-family: 'SimSun', 'å®‹ä½“', serif; font-size: 12pt; line-height: 1.8; }
                        .header { text-align: center; border-bottom: 3px double #333; padding-bottom: 20px; margin-bottom: 30px; }
                        .title { font-size: 22pt; font-weight: bold; margin-bottom: 10px; }
                        .subtitle { font-size: 10pt; color: #666; }
                        .section { margin: 20px 0; }
                        .section-title { font-size: 14pt; font-weight: bold; border-left: 4px solid #333; padding-left: 10px; margin: 15px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 11pt; }
                        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
                        th { background-color: #f0f0f0; font-weight: bold; width: 30%; }
                        .value-cell { text-align: right; font-weight: bold; color: #000; }
                        .formula { font-size: 10pt; color: #666; font-style: italic; margin-top: 5px; }
                        .result-box { background-color: #f5f5f5; border: 2px solid #333; padding: 15px; margin: 20px 0; text-align: center; }
                        .result-value { font-size: 18pt; font-weight: bold; color: #c00000; }
                        .footer { margin-top: 50px; font-size: 10pt; color: #666; text-align: center; border-top: 1px solid #ccc; padding-top: 20px; }
                        .coef-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 10pt; }
                        .coef-item { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px dotted #ccc; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="title">äºŒæ‰‹è½¦ä»·å€¼è¯„ä¼°æŠ¥å‘Š</div>
                        <div class="subtitle">æŠ¥å‘Šç¼–å·ï¼š${reportNo} &nbsp;&nbsp; è¯„ä¼°æ—¥æœŸï¼š${dateStr}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">ä¸€ã€é‡ç½®æˆæœ¬æ„æˆ</div>
                        <table>
                            <tr><th>é¡¹ç›®</th><th>é‡‘é¢ï¼ˆä¸‡å…ƒï¼‰</th><th>è¯´æ˜</th></tr>
                            <tr><td>æ–°è½¦è´­ç½®ä»·</td><td class="value-cell">${data.carPrice.toFixed(2)}</td><td>è½¦è¾†è£¸è½¦ä»·æ ¼</td></tr>
                            <tr><td>è´­ç½®ç¨</td><td class="value-cell">${data.purchaseTax.toFixed(2)}</td><td>è½¦è¾†è´­ç½®ç¨</td></tr>
                            <tr><td>å…¶ä»–æ”¯å‡º</td><td class="value-cell">${data.otherCost.toFixed(2)}</td><td>ä¸Šç‰Œè´¹ã€ä¿é™©ç­‰</td></tr>
                            <tr style="background-color:#ffffcc"><td><strong>æ›´æ–°é‡ç½®æˆæœ¬åˆè®¡</strong></td><td class="value-cell"><strong>${data.resetCost.toFixed(2)}</strong></td><td> </td></tr>
                        </table>
                        <div class="formula">è®¡ç®—å…¬å¼ï¼šé‡ç½®æˆæœ¬ = æ–°è½¦è´­ç½®ä»· + è´­ç½®ç¨ + å…¶ä»–æ”¯å‡º</div>
                    </div>

                    <div class="section">
                        <div class="section-title">äºŒã€è½¦è¾†ä½¿ç”¨æƒ…å†µ</div>
                        <table>
                            <tr><th>é¡¹ç›®</th><th>å®é™…æ•°å€¼</th><th>è§„å®šæ ‡å‡†</th><th>åˆ©ç”¨ç‡</th></tr>
                            <tr>
                                <td>ä½¿ç”¨å¹´é™</td>
                                <td class="value-cell">${data.usedYears.toFixed(1)} å¹´</td>
                                <td class="value-cell">${data.totalYears.toFixed(0)} å¹´</td>
                                <td class="value-cell">${((data.usedYears/data.totalYears)*100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td>è¡Œé©¶é‡Œç¨‹</td>
                                <td class="value-cell">${data.usedMileage.toLocaleString()} km</td>
                                <td class="value-cell">${data.totalMileage.toLocaleString()} km</td>
                                <td class="value-cell">${((data.usedMileage/data.totalMileage)*100).toFixed(1)}%</td>
                            </tr>
                        </table>
                    </div>

                    <div class="section">
                        <div class="section-title">ä¸‰ã€æˆæ–°ç‡è®¡ç®—</div>
                        <table>
                            <tr><th>è®¡ç®—é¡¹ç›®</th><th>è®¡ç®—ç»“æœ</th><th>è®¡ç®—å…¬å¼</th></tr>
                            <tr>
                                <td>å¹´é™æˆæ–°ç‡</td>
                                <td class="value-cell">${data.yearRate.toFixed(1)}%</td>
                                <td>(1 - ${data.usedYears}/${data.totalYears}) Ã— 100%</td>
                            </tr>
                            <tr>
                                <td>é‡Œç¨‹æˆæ–°ç‡</td>
                                <td class="value-cell">${data.mileageRate.toFixed(1)}%</td>
                                <td>(1 - ${data.usedMileage.toLocaleString()}/${data.totalMileage.toLocaleString()}) Ã— 100%</td>
                            </tr>
                            <tr style="background-color:#e6f3ff">
                                <td>åŸºç¡€æˆæ–°ç‡</td>
                                <td class="value-cell">${data.conditionRate.toFixed(1)}%</td>
                                <td>å¹´é™æˆæ–°ç‡ Ã— é‡Œç¨‹æˆæ–°ç‡</td>
                            </tr>
                        </table>
                    </div>

                    <div class="section">
                        <div class="section-title">å››ã€ç»¼åˆè°ƒæ•´ç³»æ•°æ˜ç»†</div>
                        <table>
                            <tr><th>è°ƒæ•´å› ç´ </th><th>ç³»æ•°å€¼ (0-1)</th><th>è°ƒæ•´å› ç´ </th><th>ç³»æ•°å€¼ (0-1)</th></tr>
                            <tr>
                                <td>è½¦å†µæŠ€æœ¯çŠ¶å†µ</td><td class="value-cell">${data.techStatus.toFixed(2)}</td>
                                <td>ç»´æŠ¤ä¿å…»</td><td class="value-cell">${data.maintenance.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>å“ç‰Œè½¦å‹å£ç¢‘</td><td class="value-cell">${data.reputation.toFixed(2)}</td>
                                <td>è½¦è¾†ç”¨é€”</td><td class="value-cell">${data.usage.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>å·¥ä½œç¯å¢ƒ</td><td class="value-cell">${data.environment.toFixed(2)}</td>
                                <td>é…ç½®ä¸é¢œè‰²</td><td class="value-cell">${data.config.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>ç”µæ± å¥åº·ç¨‹åº¦</td><td class="value-cell">${data.battery.toFixed(2)}</td>
                                <td>ä¸‰ç”µç³»ç»ŸçŠ¶æ€</td><td class="value-cell">${data.powerSystem.toFixed(2)}</td>
                            </tr>
                            <tr style="background-color:#e6f3ff">
                                <td colspan="2"><strong>ç»¼åˆè°ƒæ•´ç³»æ•°ä¹˜ç§¯</strong></td>
                                <td colspan="2" class="value-cell"><strong>${data.adjustCoef.toFixed(4)}</strong></td>
                            </tr>
                        </table>
                        <div class="formula">è®¡ç®—å…¬å¼ï¼šç»¼åˆè°ƒæ•´ç³»æ•° = å„ç³»æ•°ç›¸ä¹˜ï¼ˆæ¯é¡¹ç³»æ•°èŒƒå›´ï¼š0-1ï¼‰</div>
                    </div>

                    <div class="section">
                        <div class="section-title">äº”ã€è¯„ä¼°ç»“è®º</div>
                        <table>
                            <tr><th>é¡¹ç›®</th><th>æ•°å€¼</th><th>è¯´æ˜</th></tr>
                            <tr>
                                <td>ç»¼åˆæˆæ–°ç‡</td>
                                <td class="value-cell">${data.finalRate.toFixed(2)}%</td>
                                <td>åŸºç¡€æˆæ–°ç‡ Ã— ç»¼åˆè°ƒæ•´ç³»æ•°</td>
                            </tr>
                            <tr>
                                <td>æ›´æ–°é‡ç½®æˆæœ¬</td>
                                <td class="value-cell">${data.resetCost.toFixed(2)} ä¸‡å…ƒ</td>
                                <td> </td>
                            </tr>
                        </table>
                        
                        <div class="result-box">
                            <div style="font-size: 12pt; margin-bottom: 10px;">è¯„ä¼°ä»·å€¼</div>
                            <div class="result-value">${data.finalValue.toFixed(2)} ä¸‡å…ƒ</div>
                            <div style="font-size: 10pt; color: #666; margin-top: 10px;">
                                ï¼ˆå¤§å†™ï¼š${numberToChinese(data.finalValue)}ä¸‡å…ƒæ•´ï¼‰
                            </div>
                        </div>
                        
                        <div class="formula" style="text-align: center; font-size: 11pt; color: #333;">
                            è¯„ä¼°ä»·å€¼ = æ›´æ–°é‡ç½®æˆæœ¬ Ã— ç»¼åˆæˆæ–°ç‡<br>
                            ${data.resetCost.toFixed(2)} Ã— ${data.finalRate.toFixed(2)}% = ${data.finalValue.toFixed(2)} ä¸‡å…ƒ
                        </div>
                    </div>

                    <div class="section" style="margin-top: 40px;">
                        <div class="section-title">å…­ã€è¯„ä¼°æ–¹æ³•è¯´æ˜</div>
                        <div style="font-size: 10.5pt; line-height: 2; text-align: justify;">
                            <p>1. æœ¬è¯„ä¼°é‡‡ç”¨æˆæœ¬æ³•ï¼ˆé‡ç½®æˆæœ¬æ³•ï¼‰è¿›è¡Œæµ‹ç®—ï¼Œå…¬å¼ä¸ºï¼šè¯„ä¼°å€¼ = é‡ç½®æˆæœ¬ Ã— æˆæ–°ç‡ã€‚</p>
                            <p>2. æˆæ–°ç‡é‡‡ç”¨ä½¿ç”¨å¹´é™æ³•å’Œè¡Œé©¶é‡Œç¨‹æ³•å­°ä½åŸåˆ™ç¡®å®šåŸºç¡€æˆæ–°ç‡ï¼Œå†ç»¼åˆå„é¡¹è°ƒæ•´ç³»æ•°ä¿®æ­£ã€‚</p>
                            <p>3. è°ƒæ•´ç³»æ•°å–å€¼èŒƒå›´ä¸º0-1ï¼Œæ ¹æ®è½¦è¾†å®é™…æŠ€æœ¯çŠ¶å†µã€ç»´æŠ¤ä¿å…»æƒ…å†µã€å¸‚åœºå£ç¢‘ã€ä½¿ç”¨å¼ºåº¦ç­‰å› ç´ ç”±ä¸“ä¸šè¯„ä¼°å¸ˆç°åœºå‹˜å¯Ÿç¡®å®šã€‚å…¶ä¸­1è¡¨ç¤ºæœ€ä½³çŠ¶æ€ï¼Œ0è¡¨ç¤ºæœ€å·®çŠ¶æ€ã€‚</p>
                            <p>4. æœ¬è¯„ä¼°ç»“æœä»…ä¾›äº¤æ˜“å‚è€ƒï¼Œå®é™…æˆäº¤ä»·æ ¼å—å¸‚åœºä¾›éœ€ã€ä¹°å–åŒæ–¹è®®ä»·èƒ½åŠ›ç­‰å› ç´ å½±å“ã€‚</p>
                        </div>
                    </div>

                    <div class="footer">
                        <p>æœ¬æŠ¥å‘Šç”±äºŒæ‰‹è½¦è¯„ä¼°ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ</p>
                        <p>ç”Ÿæˆæ—¶é—´ï¼š${date.toLocaleString()}</p>
                    </div>
                </body>
                </html>
            `;
            
            // è½¬æ¢ä¸ºBlobå¹¶ä¸‹è½½
            const blob = new Blob([content], { type: 'application/msword;charset=utf-8' });
            const filename = `äºŒæ‰‹è½¦è¯„ä¼°æŠ¥å‘Š_${reportNo}.doc`;
            
            // å…¼å®¹Edgeæµè§ˆå™¨
            if ('msSaveOrOpenBlob' in navigator) {
                navigator.msSaveOrOpenBlob(blob, filename);
            } else {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            }
        }
        
        // æ•°å­—è½¬ä¸­æ–‡å¤§å†™
        function numberToChinese(num) {
            const digits = ['é›¶','å£¹','è´°','å','è‚†','ä¼','é™†','æŸ’','æŒ','ç–'];
            const units = ['','æ‹¾','ä½°','ä»Ÿ','ä¸‡','æ‹¾','ä½°','ä»Ÿ','äº¿'];
            const decimalUnits = ['è§’','åˆ†'];
            
            let str = '';
            const integerPart = Math.floor(num);
            const decimalPart = Math.round((num - integerPart) * 100);
            
            // å¤„ç†æ•´æ•°éƒ¨åˆ†
            let intStr = integerPart.toString();
            let zeroFlag = false;
            for (let i = 0; i < intStr.length; i++) {
                const digit = parseInt(intStr[i]);
                const unit = units[intStr.length - 1 - i];
                if (digit === 0) {
                    if (!zeroFlag && i !== intStr.length - 1) {
                        str += digits[0];
                        zeroFlag = true;
                    }
                } else {
                    str += digits[digit] + unit;
                    zeroFlag = false;
                }
            }
            
            if (integerPart === 0) str = 'é›¶';
            str += 'ä¸‡';
            
            // å¤„ç†å°æ•°éƒ¨åˆ†
            if (decimalPart > 0) {
                const jiao = Math.floor(decimalPart / 10);
                const fen = decimalPart % 10;
                if (jiao > 0) str += digits[jiao] + decimalUnits[0];
                if (fen > 0) str += digits[fen] + decimalUnits[1];
            } else {
                str += 'æ•´';
            }
            
            return str;
        }
        
        function resetForm() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                document.querySelectorAll('input').forEach(input => input.value = '');
                calculate();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è®¡ç®—ä¸€æ¬¡
        calculate();
    </script>
</body>
</html>